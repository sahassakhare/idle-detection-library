<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Angular 18+ OAuth Idle Detection Demo</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .header {
            background: #2c3e50;
            color: white;
            padding: 2rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            text-align: center;
        }
        .card {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 1.5rem;
            border: 1px solid #e0e0e0;
        }
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }
        .feature {
            padding: 1rem;
            border-left: 4px solid #3498db;
            background: #f8f9fa;
        }
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 6px;
            overflow-x: auto;
            font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
            font-size: 0.875rem;
            margin: 1rem 0;
        }
        .highlight {
            background: #fff3cd;
            padding: 1rem;
            border-radius: 6px;
            border-left: 4px solid #ffc107;
            margin: 1rem 0;
        }
        .status-demo {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }
        .status-card {
            padding: 1rem;
            border-radius: 6px;
            text-align: center;
            border: 2px solid;
        }
        .status-active {
            background: #d4edda;
            border-color: #27ae60;
            color: #155724;
        }
        .status-idle {
            background: #fff3cd;
            border-color: #f39c12;
            color: #856404;
        }
        .status-warning {
            background: #f8d7da;
            border-color: #e74c3c;
            color: #721c24;
            animation: pulse 1s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .btn {
            background: #3498db;
            color: white;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            margin: 0.5rem;
            transition: background 0.2s;
        }
        .btn:hover {
            background: #2980b9;
        }
        .btn-success {
            background: #27ae60;
        }
        .btn-success:hover {
            background: #219a52;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üöÄ Angular 18+ OAuth Idle Detection Integration</h1>
        <p>Complete solution for session management with modern Angular and OIDC</p>
    </div>

    <div class="card">
        <h2>‚ú® What's New in Angular 18+ Integration</h2>
        <div class="feature-grid">
            <div class="feature">
                <h3>üéØ Angular 18+ Compatible</h3>
                <p>Uses latest Angular features including signals, standalone components, and the new control flow</p>
            </div>
            <div class="feature">
                <h3>üîê angular-auth-oidc-client</h3>
                <p>Integrated with the most popular Angular OIDC library for robust authentication</p>
            </div>
            <div class="feature">
                <h3>‚ö° Signals & Modern APIs</h3>
                <p>Built with Angular signals for reactive state management and better performance</p>
            </div>
            <div class="feature">
                <h3>üé® Standalone Components</h3>
                <p>Fully standalone architecture - no NgModules required</p>
            </div>
        </div>
    </div>

    <div class="card">
        <h2>üõ†Ô∏è Quick Setup</h2>
        <p>Get started with just a few lines of code:</p>
        
        <h3>1. Install Dependencies</h3>
        <div class="code-block">npm install @idle-detection/angular-oauth-integration
npm install angular-auth-oidc-client
npm install @idle-detection/core</div>

        <h3>2. Bootstrap Your Application</h3>
        <div class="code-block">// main.ts
import { bootstrapApplication } from '@angular/platform-browser';
import { provideAuth } from 'angular-auth-oidc-client';
import { provideIdleOAuth } from '@idle-detection/angular-oauth-integration';

bootstrapApplication(AppComponent, {
  providers: [
    // OIDC Configuration
    provideAuth({
      config: {
        authority: 'https://your-oidc-provider.com',
        clientId: 'your-client-id',
        scope: 'openid profile email',
        responseType: 'code'
      }
    }),
    
    // Idle Detection Configuration
    provideIdleOAuth({
      idleTimeout: 15 * 60 * 1000,      // 15 minutes
      warningTimeout: 2 * 60 * 1000,    // 2 minutes
      autoRefreshToken: true,
      enableMultiTabCoordination: true
    })
  ]
});</div>

        <h3>3. Use in Your Component</h3>
        <div class="code-block">// app.component.ts
import { Component, inject, signal } from '@angular/core';
import { IdleOAuthService, IdleWarningDialogComponent } from '@idle-detection/angular-oauth-integration';

@Component({
  selector: 'app-root',
  standalone: true,
  imports: [IdleWarningDialogComponent],
  template: `
    &lt;div class="app"&gt;
      &lt;!-- Your app content --&gt;
      &lt;router-outlet&gt;&lt;/router-outlet&gt;
      
      &lt;!-- Warning dialog appears automatically --&gt;
      &lt;idle-warning-dialog *ngIf="showWarning()"&gt;&lt;/idle-warning-dialog&gt;
    &lt;/div&gt;
  `
})
export class AppComponent {
  private idleService = inject(IdleOAuthService);
  showWarning = signal(false);

  ngOnInit() {
    this.idleService.startWatching();
    
    this.idleService.state$.subscribe(state => {
      this.showWarning.set(state.isWarning);
    });
  }
}</div>
    </div>

    <div class="card">
        <h2>üé≠ Session States Demo</h2>
        <p>The integration automatically manages these session states:</p>
        
        <div class="status-demo">
            <div class="status-card status-active">
                <h4>üü¢ Active</h4>
                <p>User is actively using the application</p>
            </div>
            <div class="status-card status-idle">
                <h4>üü° Idle</h4>
                <p>No activity detected for configured time</p>
            </div>
            <div class="status-card status-warning">
                <h4>üî¥ Warning</h4>
                <p>Session about to expire - dialog shown</p>
            </div>
        </div>
    </div>

    <div class="card">
        <h2>üîß Configuration Options</h2>
        <div class="code-block">interface AngularIdleOAuthConfig {
  // Core settings
  idleTimeout?: number;                    // Time before idle (default: 15 min)
  warningTimeout?: number;                 // Warning duration (default: 2 min)
  autoResume?: boolean;                    // Auto-resume on activity (default: true)
  
  // OAuth integration
  autoRefreshToken?: boolean;              // Auto-refresh tokens (default: true)
  timeoutRedirectUrl?: string;             // Redirect after timeout
  
  // Multi-tab coordination
  enableMultiTabCoordination?: boolean;    // Sync across tabs (default: true)
  multiTabStorageKey?: string;             // Storage key for coordination
  
  // UI customization
  showWarningDialog?: boolean;             // Show warning dialog (default: true)
  warningDialogComponent?: any;            // Custom dialog component
  
  // Debug
  debug?: boolean;                         // Enable debug logging
}</div>
    </div>

    <div class="card">
        <h2>üöÄ Advanced Features</h2>
        <div class="feature-grid">
            <div class="feature">
                <h3>üîÑ Automatic Token Refresh</h3>
                <p>Automatically refreshes OIDC tokens when user becomes active during warning period</p>
            </div>
            <div class="feature">
                <h3>üåê Multi-tab Coordination</h3>
                <p>Synchronizes idle state across multiple browser tabs using localStorage</p>
            </div>
            <div class="feature">
                <h3>üì± Mobile Responsive</h3>
                <p>Warning dialog is fully responsive and mobile-friendly</p>
            </div>
            <div class="feature">
                <h3>‚ôø Accessibility</h3>
                <p>ARIA labels and keyboard navigation support</p>
            </div>
            <div class="feature">
                <h3>üé® Customizable UI</h3>
                <p>Provide your own warning dialog component</p>
            </div>
            <div class="feature">
                <h3>üîí Security First</h3>
                <p>Automatic logout and session cleanup on timeout</p>
            </div>
        </div>
    </div>

    <div class="card">
        <h2>üéØ Auth Guard Integration</h2>
        <p>Seamlessly integrate with Angular route guards:</p>
        <div class="code-block">// auth.guard.ts
import { inject } from '@angular/core';
import { CanActivateFn } from '@angular/router';
import { OidcSecurityService } from 'angular-auth-oidc-client';
import { IdleOAuthService } from '@idle-detection/angular-oauth-integration';

export const AuthGuard: CanActivateFn = () => {
  const oidcSecurityService = inject(OidcSecurityService);
  const idleService = inject(IdleOAuthService);

  return oidcSecurityService.checkAuth().pipe(
    map((result) => {
      if (result.isAuthenticated) {
        idleService.startWatching(); // Start monitoring
        return true;
      }
      return false;
    })
  );
};</div>
    </div>

    <div class="highlight">
        <h3>üéâ Ready to Use!</h3>
        <p>This integration provides everything you need for production-ready session management:</p>
        <ul>
            <li>‚úÖ <strong>Angular 18+</strong> with signals and standalone components</li>
            <li>‚úÖ <strong>OIDC Integration</strong> with angular-auth-oidc-client</li>
            <li>‚úÖ <strong>Automatic token refresh</strong> on user activity</li>
            <li>‚úÖ <strong>Multi-tab session coordination</strong></li>
            <li>‚úÖ <strong>Responsive warning dialog</strong></li>
            <li>‚úÖ <strong>TypeScript</strong> with full type safety</li>
            <li>‚úÖ <strong>SSR/Universal</strong> compatibility</li>
            <li>‚úÖ <strong>Production tested</strong> and maintained</li>
        </ul>
        
        <div style="text-align: center; margin-top: 1.5rem;">
            <a href="#" class="btn btn-success">üìö View Documentation</a>
            <a href="#" class="btn">üîß View Source Code</a>
        </div>
    </div>

    <script>
        // Simple demo of idle detection concepts
        let lastActivity = new Date();
        let isIdle = false;
        let isWarning = false;
        
        function updateActivity() {
            lastActivity = new Date();
            if (isIdle || isWarning) {
                isIdle = false;
                isWarning = false;
                console.log('User activity detected - session restored');
            }
        }
        
        function checkIdleStatus() {
            const now = new Date();
            const timeSinceActivity = now - lastActivity;
            
            if (timeSinceActivity > 30000 && !isWarning) { // 30 seconds for demo
                isIdle = true;
                console.log('User went idle');
            }
            
            if (timeSinceActivity > 45000 && !isWarning) { // 45 seconds for demo
                isWarning = true;
                console.log('Warning: Session will expire soon');
            }
        }
        
        // Monitor activity
        ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart'].forEach(event => {
            document.addEventListener(event, updateActivity, true);
        });
        
        // Check idle status every second
        setInterval(checkIdleStatus, 1000);
        
        console.log('üöÄ Demo idle detection running - check console for activity logs');
        console.log('üí° Try staying idle for 30+ seconds to see idle detection in action');
    </script>
</body>
</html>